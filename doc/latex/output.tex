{% -*- mode: LaTeX; TeX-PDF-mode: t; TeX-master: "manual"; -*-
}

\chapter{The \ei Output Language}
\label{ch:eiol}

In this chapter we describe a text-based output language that allows
applications to view their output in a graphical way, e.g.,
highlighting lines, adding markers, defining on-click actions, etc.
%
Some clients, e.g., the web-client, interpret this language and render
the effect of the corresponding commands in the respective
environment. An output in this language is an XML structure the adhere
to the syntax of \xmlstructref{eiout}{eiout} that is described below.


\section{Syntax and Semantics}
%% EIOUT
%%
\bigskip
\xmlstruct
{eiout}
{eiout} 
{%
%
  This is the main environment of the output, it includes several
  lists of command environments \xmlstructref{eiout}{eicommands}, and
  several lists of action environments \xmlstructref{eiout}{eiactions}.
%
  Commands are executed first, in the given order, and then actions are
  executed in the given order as well.
%
  The \xmlstructattr{version} attribute indicates the version of the
  output language that is used, which is $1.0$ by default.
%
}


%% EICOMMANDS
%% 
\bigskip
\xmlstruct
{eiout}
{eicommands}
{%
%
A list of commands to be performed.
%
The attribute \xmlstructattr{dest} is the destination file on which
the command is applied (if needed).
%
E.g., when highlighting a line we might want to highlight a line in
one file or another. 
%
If \xmlstructattr{dest} is not specified, then the commands will be
applied to the file that is currently active, e.g., if the client have
a code editor with several tabs, one for each file, the command will
be applied to the active tab. If none is active then the behavior is
not specified.
% 
The attribute \xmlstructattr{outclass} specifies the \emph{output
  class} of the commands in this environment, that is, the nature of
the corresponding output generated by the commands, e.g., error,
information, warning, etc.
%
All commands inside this environment inherit the values of
\xmlstructattr{outclass} and \xmlstructattr{dest}, and each can
overwrite them.
%
}


%% EIACTIONS
%% 
\bigskip
\xmlstruct
{eiout}
{eiactions}
{%
%
  A a list of actions to be declared. An action typically executes a
  list of \xmlstructref{eiout}{eicommands} when the user interacts with the
  interface in some predetermined way, e.g., \emph{when the user
    clicks on line 30, highlight lines number 12 and 16}. We say the
  an action is \emph{performed} as a response to the user interaction.
%
  If the user interacts again with the interface, according to what is
  specified in the action, then the action is \emph{unperformed} if
  possible (when the corresponding commands support the \emph{undo}
  operation), e.g., in the above example if the user clicks again on
  line 30 the highlights of lines 12 and 16 are turned off.

  Before \emph{performing} an action, the last \emph{performed} action
  is \emph{unperformed} first. This behavior can be disabled by
  setting the \xmlstructattr{autoclean} attribute to
  \xmlstructvalue{``false''}. All actions inside this environment
  inherit the value of \xmlstructattr{autoclean}, and each can
  overwrite it.
% 
  The attribute \xmlstructattr{dest} and \xmlstructattr{outclass} are
  as in the case of commands (see the description of
  \xmlstructref{eiout}{eicommands}).
%
}


%% EICOMMAND
%% 
\bigskip
\xmlstruct
{eiout}
{eicommand}
{
A command in the \ei output language, briefly:
\begin{itemize}
\item \xmlstructref{eiout}{printonconsolecommand} can be used to print on the console.
%
\item \xmlstructref{eiout}{highlightlinescommand} can be used to highlight
  lines in the code editor.
%
\item \xmlstructref{eiout}{dialogboxcommand} can be used to open a dialog
  window with a corresponding message.
%
\item \xmlstructref{eiout}{writefilecommand} can be used to add a file (and a
  corresponding content) to the files tree.
%
\item \xmlstructref{eiout}{setcsscommand} can be used to change the CSS
  properties of some elements.
%
\item \xmlstructref{eiout}{addmarkercommand} can be used to add a marker next
  to a line in the code editor.
%
\item \xmlstructref{eiout}{addinlinemarkercommand} can be used to add a line
  widget (an inlined marker) in the code editor.
%
\end{itemize}
}


%% EIACTION
%% 
\bigskip
\xmlstruct
{eiout}
{eiaction}
{%
An action in the \ei output language, briefly:
\begin{itemize}
%
\item \xmlstructref{eiout}{oncodelineclickaction} can be used to perform an action
  when the user clicks on a line in the code editor.
%
\item \xmlstructref{eiout}{onclickaction} can be used to perform an action
  when the user clicks on a DOM element.
%
\end{itemize}
}


%% PRINTONCONSOLE
%%
\bigskip
\xmlstruct
{eiout}
{printonconsolecommand}
{%
%
  Print the content of the \xmlstructref{eiout}{content} environments on the
  console with identifier \xmlstructattr{consoleid}.
%
  If \xmlstructattr{consoleid} is not specified, the output goes to
  the default console.
%
  If \xmlstructattr{consoleid} is specified but there is no console
  with such an identifier, the console is created and
  \xmlstructattr{consoletitle} (if specified) is used as its title.
%
  The attribute \xmlstructattr{outclass} is as described in
  \xmlstructref{eiout}{eicommands}.
%
} 

\bigskip
\xmlstruct
{eiout}
{highlightlinescommand}
{%
%
  Highlight the lines specified by \xmlstructref{eiout}{lines} in the file
  \xmlstructattr{dest}. The attribute \xmlstructattr{outclass} is as
  described in \xmlstructref{eiout}{eicommands}.
%
}


\bigskip
\xmlstruct
{eiout}
{dialogboxcommand}
{%
  Open a dialog box with the content specified by the
  \xmlstructref{eiout}{content} environemnts. The value of
  \xmlstructattr{boxtitle}, if specfied, is used as a title for the
  dialog box. The attribtes \xmlstructattr{boxwidth} and
  \xmlstructattr{boxheight} can be used to set the size of the window.
  The attribute \xmlstructattr{outclass} is as in
  \xmlstructref{eiout}{eicommands}.
%
}


\bigskip 
\xmlstruct 
{eiout}
{writefilecommand} 
{%
%
  Create a new file and place it in the files view, using the path
  specified by \xmlstructattr{filename}. The file is initialized with
  the all text \xmlstructref{eiout}{text} inside this tag. If the file
  exists, and \xmlstructattr{overwrite} is true the content is
  replaced otherwise a new file is created with a new name. The
  default value of \xmlstructattr{overwrite} is
  \xmlstructvalue{false}.
% 
%  This command does not support \emph{undo}.
%
}


\bigskip
\xmlstruct
{eiout}
{setcsscommand}
{%
%
  Change the CSS properties, as specified by
  \xmlstructref{eiout}{cssproperties}, of all elements that match the
  selector in \xmlstructref{eiout}{elements}.
%
  There must be exactly one \xmlstructref{eiout}{elements} environment and
  one \xmlstructref{eiout}{cssproperties} environment. 
%
  The elements are typically selected from those generated by other
  commands.
%
}


\bigskip
\xmlstruct
{eiout}
{addmarkercommand}
{%
%
  Add a marker next to each line that is specified in
  \xmlstructref{eiout}{lines}. The column information from each
  \xmlstructref{eiout}{line} in \xmlstructref{eiout}{lines} is
  ignored.  All markers are associated with the content given by the
  \xmlstructref{eiout}{content} environments, as a tooltip. If the
  client allows expanding the tooltip to a dialog window, the
  attributes \xmlstructattr{boxtitle}, \xmlstructattr{boxwidth} and
  \xmlstructattr{boxheight} can be used to set the properties of the
  corresponding window (see \xmlstructref{eiout}{dialogboxcommand}).
%
  The attributes \xmlstructattr{dest} and \xmlstructattr{outclass} are
  as described in \xmlstructref{eiout}{eicommands}.
%
}

\bigskip
\xmlstruct
{eiout}
{addinlinemarkercommand}
{%
%
  Add an inline marker (a line widget) for each line that is specified
  by \xmlstructref{eiout}{lines}. All line widgets will include the content
  specified by the \xmlstructref{eiout}{content} environments. In some
  clients, the supported content might be only of text format.
%
  The attributes \xmlstructattr{dest} and \xmlstructattr{outclass} are
  as described in \xmlstructref{eiout}{eicommands}.
%
}


\bigskip
\xmlstruct
{eiout}
{oncodelineclickaction}
{%
%
  Add markers at the the code lines specified by \xmlstructref{eiout}{lines},
  such that when any is clicked the commands in
  \xmlstructref{eiout}{eicommands} are performed.
  % 
  The content given by the \xmlstructref{eiout}{content} environemts is
  associated with the markers (as a tooltip for example).
%
  The attributes \xmlstructattr{dest} and \xmlstructattr{outclass} are
  as described in \xmlstructref{eiout}{eiactions}. Moreover, the above
  \xmlstructref{eiout}{eicommands} environment inherits the
  \xmlstructattr{dest} and \xmlstructattr{outclass} attributes of this
  environment.
%
}


\bigskip
\xmlstruct
{eiout}
{onclickaction}
{%
%
  A click on any DOM element that matches the selector of
  \xmlstructref{eiout}{elements}, will execute the commands declared in
  \xmlstructref{eiout}{eicommands}.
%
  The attributes \xmlstructattr{dest} and \xmlstructattr{outclass} are
  as described in \xmlstructref{eiout}{eiactions}. Moreover, the above
  \xmlstructref{eiout}{eicommands} environment inherits the
  \xmlstructattr{dest} and \xmlstructattr{outclass} attributes of this
  environment.
%
}



%% 
\bigskip
\xmlstruct
{eiout}
{lines}
{
A group of lines, typically used to specify the lines affected by 
an \xmlstructref{eiout}{eicommand} or an \xmlstructref{eiout}{eiaction}.
}


%% 
\bigskip
\xmlstruct
{eiout}
{line}
{%
%
  A region (of lines) typically used to specify the region on which
  the effect of an \xmlstructref{eiout}{eicommand} or an
  \xmlstructref{eiout}{eiaction} is applied:
%
\begin{itemize}
\item \xmlstructattr{from} is the start line.
\item \xmlstructattr{to} is the end line.
\item \xmlstructattr{fromch} is the  where the first line starts.
\item \xmlstructattr{toch} is the character (i.e., column number) where the last line ends.
\end{itemize}
%
The default value of \xmlstructattr{to} is as the value of
\xmlstructattr{from}. The default value of \xmlstructattr{colfrom} is
0, and of \xmlstructattr{colto} is the end of the line.
%
}

\bigskip
\xmlstruct
{eiout}
{elements}
{%
  Set of selectors (of DOM elements)
} 

\bigskip
\xmlstruct
{eiout}
{selector}
{%
%
  The attribute \xmlstructattr{value} musy be valid selector as in
  JQuery (see \url{https://jquery.com}). It is used to match some DOM
  elements.
%
}


\bigskip
\xmlstruct
{eiout}
{cssproperties}
{%
%
A set of CSS properties.
%
}


\bigskip
\xmlstruct
{eiout}
{cssproperty}
{%
%
  A CSS property. The attributes \xmlstructattr{name} and this
  \xmlstructattr{value} should correspond to valid CSS properties.
%
}


%% CONTENT
\bigskip
\xmlstruct
{eiout}
{content}
{%
%
  A text given in a specific \xmlstructattr{format}, e.g.,
  \xmlstructvalue{"text"}, \xmlstructvalue{"html"}, etc. If the
  attribute \xmlstructattr{format} is not provided, then it is assumed
  to be \xmlstructvalue{"text"} format (plain text).
%
}

\bigskip
\noindent
\xmlstructdef{eiout}{consoleid}

( [a-z,A-Z,0-9,-,\_]+ | new | default )

\medskip
\noindent
The value 'new' means a new console, no reference to this console is
saved. The value 'default' means the default console of the client.

\bigskip
\noindent
\xmlstructdef{eiout}{path}

\noindent
A path to file, including the file name. There are two from, the first
one is a full path including the temporal directory name that is
created by the server, e.g.,
``\texttt{/tmp/easyinterfae\_XYZ/\_ei\_files/dir1/dir2/file.c}''. The
simply ignore the prefix we
``\texttt{/tmp/easyinterfae\_XYZ/\_ei\_files/}'', i.e., the value in
this case is ``\texttt{dir1/dir2/file.c}''.

\bigskip
\noindent
\xmlstructdef{eiout}{version}

$x.y$, where $x$ is the major version number and $y$ is the minor one,
e.g. $1.0$, $1.1$, etc.

\bigskip
\noindent
\xmlstructdef{eiout}{outclass}

( none | info | warning | error )

\bigskip
\noindent
\xmlstructdef{eiout}{bool}

( \lst{"true"} | \lst{"false"} )

\bigskip
\noindent
\xmlstructdef{eiout}{int}

An integer

\bigskip
\noindent
\xmlstructdef{eiout}{string}

A string

\bigskip
\noindent
\xmlstructdef{eiout}{text}

Free text.

\bigskip
\noindent
\xmlstructdef{eiout}{textformat}

( \lst{"text"} | \lst{"html"} | \lst{"svg"})

\bigskip
\noindent
\xmlstructdef{eiout}{cssname}

A valid name for a CSS property.

\bigskip
\noindent
\xmlstructdef{eiout}{cssval}

A valid value for a corresponding CSS property.



